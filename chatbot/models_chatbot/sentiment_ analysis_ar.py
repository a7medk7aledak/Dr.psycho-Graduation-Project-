import re
from collections import defaultdict

# قاموس موسع للكلمات المفتاحية للمشاعر مع تصنيفها
emotion_keywords = {
    'فرح عام': {'keywords': ['سعيد', 'فرح', 'مسرور', 'مبتهج', 'مرح', 'سعادة', 'ابتهاج', 'متحمس', 'فرحان', 'منتعش', 'متفائل', 'راضي', 'مغتبط', 'منشرح', 'مبسوط', 'على وجه السرور'], 'sentiment': 'إيجابي'},
    'نشوة': {'keywords': ['مزهو', 'منتشي', 'طائر من الفرح', 'في قمة السعادة', 'في غاية السرور', 'غامر بالسعادة', 'يطير من الفرح', 'في حالة نشوة'], 'sentiment': 'إيجابي'},
    'ارتياح': {'keywords': ['مرتاح', 'هادئ البال', 'مطمئن', 'مستريح', 'في راحة نفسية', 'منشرح الصدر', 'مرتاح البال'], 'sentiment': 'إيجابي'},
    'حماس': {'keywords': ['متحمس', 'مندفع', 'متلهف', 'متشوق', 'مليء بالطاقة', 'متوهج حماساً', 'في غاية الحماس'], 'sentiment': 'إيجابي'},
    'حزن عميق': {'keywords': ['مكتئب', 'محطم', 'مفجوع', 'في حالة يرثى لها', 'غارق في الحزن', 'مثقل بالهموم', 'منهار'], 'sentiment': 'سلبي'},
    'أسى': {'keywords': ['حزين', 'متألم', 'مغموم', 'كئيب', 'منكسر القلب', 'مفطور القلب', 'في حالة أسى'], 'sentiment': 'سلبي'},
    'إحباط': {'keywords': ['محبط', 'خائب الأمل', 'مخذول', 'فاقد الأمل', 'يائس', 'قانط', 'في حالة إحباط'], 'sentiment': 'سلبي'},
    'خوف شديد': {'keywords': ['مرعوب', 'مذعور', 'فزع', 'مرتعب', 'مصاب بالهلع', 'خائف لدرجة الموت', 'مشلول من الخوف'], 'sentiment': 'سلبي'},
    'قلق': {'keywords': ['قلق', 'متوتر', 'مضطرب', 'مهموم', 'متوجس', 'غير مطمئن', 'على أعصابه'], 'sentiment': 'سلبي'},
    'توجس': {'keywords': ['متردد', 'حذر', 'متشكك', 'متوجس الخيفة', 'على حذر', 'متيقظ', 'في حالة ترقب'], 'sentiment': 'سلبي'},
    'غضب عارم': {'keywords': ['ثائر', 'هائج', 'مستشيط غضباً', 'في حالة غليان', 'منفجر من الغضب', 'فاقد السيطرة'], 'sentiment': 'سلبي'},
    'استياء': {'keywords': ['منزعج', 'مستاء', 'متضايق', 'ساخط', 'غير راضٍ', 'متذمر', 'ناقم'], 'sentiment': 'سلبي'},
    'دهشة': {'keywords': ['مندهش', 'متفاجئ', 'مذهول', 'مصدوم', 'مبهور', 'في حالة ذهول', 'فاغر الفم من المفاجأة'], 'sentiment': 'محايد'},
    'اشمئزاز': {'keywords': ['مشمئز', 'متقزز', 'مقرف', 'كاره', 'نافر', 'مستقذر', 'يشعر بالغثيان'], 'sentiment': 'سلبي'},
    'حياد': {'keywords': ['محايد', 'عادي', 'طبيعي', 'هادئ', 'غير متأثر', 'غير مبالٍ', 'على الحياد'], 'sentiment': 'محايد'},
    'حب': {'keywords': ['عاشق', 'محب', 'مغرم', 'هائم', 'ملتاع', 'مفتون', 'واله'], 'sentiment': 'إيجابي'},
    'حنين': {'keywords': ['مشتاق', 'حنين', 'متلهف للماضي', 'يحن إلى', 'نوستالجي', 'يتوق إلى', 'مليء بالشوق'], 'sentiment': 'محايد'},
    'غيرة': {'keywords': ['غيور', 'حسود', 'يشعر بالغيرة', 'محسود', 'يغار من', 'متملك', 'يشعر بالتهديد'], 'sentiment': 'سلبي'},
    'ندم': {'keywords': ['نادم', 'آسف', 'متأسف', 'يشعر بالذنب', 'مثقل بالندم', 'يلوم نفسه', 'متحسر'], 'sentiment': 'سلبي'},
    'خجل': {'keywords': ['خجول', 'مستحي', 'محرج', 'مرتبك', 'مكسوف', 'خجلان', 'في حالة إحراج'], 'sentiment': 'سلبي'},
    'فخر': {'keywords': ['فخور', 'معتز', 'مزهو بنفسه', 'يشعر بالإنجاز', 'مفتخر', 'يعتز بـ', 'يتباهى'], 'sentiment': 'إيجابي'},
    'إعجاب': {'keywords': ['معجب', 'منبهر', 'مفتون', 'مأخوذ بـ', 'يعجب بـ', 'يحترم', 'يقدر'], 'sentiment': 'إيجابي'},
    'حيرة': {'keywords': ['محتار', 'مشوش', 'مرتبك', 'غير متأكد', 'في حيرة من أمره', 'متردد', 'مضطرب الفكر'], 'sentiment': 'محايد'},
    'أمل': {'keywords': ['متفائل', 'يأمل في', 'متطلع إلى', 'واثق', 'مليء بالأمل', 'متوقع الخير', 'يتطلع بإيجابية'], 'sentiment': 'إيجابي'},
    'إرهاق': {'keywords': ['متعب', 'منهك', 'مرهق', 'خائر القوى', 'مجهد', 'مستنزف', 'بحاجة للراحة'], 'sentiment': 'سلبي'}
}

def analyze_emotion(text):
    detected_emotions = defaultdict(int)
    for emotion, data in emotion_keywords.items():
        for keyword in data['keywords']:
            if re.search(r'\b' + re.escape(keyword) + r'\b', text, re.IGNORECASE | re.UNICODE):
                detected_emotions[emotion] += 1
    
    sorted_emotions = sorted(detected_emotions.items(), key=lambda x: x[1], reverse=True)
    
    if not sorted_emotions:
        return [('حياد', 'محايد')]
    
    return [(emotion, emotion_keywords[emotion]['sentiment']) for emotion, _ in sorted_emotions[:3]]

def interpret_emotions(emotions_with_sentiment):
    emotions = [e[0] for e in emotions_with_sentiment]
    sentiments = [e[1] for e in emotions_with_sentiment]
    
    if len(emotions) == 1:
        emotion_text = f"يعبر النص بشكل أساسي عن مشاعر {emotions[0]}"
    elif len(emotions) == 2:
        emotion_text = f"يعبر النص عن مزيج من مشاعر {emotions[0]} و{emotions[1]}"
    else:
        emotion_text = f"يعبر النص عن مجموعة معقدة من المشاعر، تشمل {', '.join(emotions[:-1])} و{emotions[-1]}"
    
    if all(s == 'إيجابي' for s in sentiments):
        sentiment_text = "النص يحمل مشاعر إيجابية بشكل عام"
    elif all(s == 'سلبي' for s in sentiments):
        sentiment_text = "النص يحمل مشاعر سلبية بشكل عام"
    elif 'إيجابي' in sentiments and 'سلبي' in sentiments:
        sentiment_text = "النص يحمل مزيجًا من المشاعر الإيجابية والسلبية"
    else:
        sentiment_text = "النص يحمل مشاعر محايدة أو مختلطة"
    
    return f"{emotion_text}. {sentiment_text}."


# النصوص التي تريد تحليلها
arabic_texts = [
    "أنا سعيد جداً اليوم وأشعر بالحماس للمستقبل",
    "أشعر بالحزن والاكتئاب، وكأن العالم يضيق من حولي",
    "هذا الخبر يثير غضبي وأشعر بالاستياء الشديد",
    "أنا قلق بشأن الامتحان القادم ومتردد في قدراتي",
    "أشعر بالاطمئنان والراحة بعد إنهاء هذا المشروع الصعب",
    "هذا المنظر مقرف ومثير للاشمئزاز، لا أطيق النظر إليه",
    "أنا مندهش من هذه النتيجة غير المتوقعة، لم أكن أتوقع هذا أبداً",
    "اليوم يوم عادي، لا شيء مميز يذكر",
    "أنا فخور جداً بإنجازاتي وأشعر بالاعتزاز بنفسي",
    "أشعر بالحنين إلى أيام الطفولة وأتوق للعودة إلى تلك الأيام البسيطة",
    "أنا محتار بين خيارين صعبين ولا أعرف ماذا أفعل",
    "أشعر بالإرهاق الشديد بعد هذا اليوم الطويل وأحتاج للراحة"
]

def analyze_arabic_text(text):
    emotions_with_sentiment = analyze_emotion(text)
    print(f"النص: {text}")
    print(f"المشاعر المكتشفة: {', '.join([f'{e[0]} ({e[1]})' for e in emotions_with_sentiment])}")
    print(f"التفسير: {interpret_emotions(emotions_with_sentiment)}")
    print("-" * 50)

if __name__ == "__main__":
    # تحليل المشاعر لكل نص
    print("تحليل المشاعر:")
    for text in arabic_texts:
        analyze_arabic_text(text)
